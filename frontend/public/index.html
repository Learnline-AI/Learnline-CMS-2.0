<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI-Powered Educational CMS</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div class="app-container">
        <header class="header">
            <div class="header-content">
                <h1 class="logo">
                    <i class="fas fa-graduation-cap"></i>
                    Educational CMS
                </h1>
                <div class="header-subtitle">AI-Powered Content Management</div>
            </div>
        </header>

        <main class="main-content">
            <!-- Template Editor Section -->
            <section id="template-editor-section" class="section active">
                <!-- Component Toolbar -->
                <div class="component-toolbar">
                    <div class="toolbar-header">
                        <h3>Learnline Content Management System</h3>
                        <p>Drag components to build your educational content</p>

                        <!-- Text Formatting Toolbar -->
                        <div class="text-formatting-toolbar" id="text-formatting-toolbar">
                            <div class="toolbar-controls">
                                <div class="font-size-controls">
                                    <label for="font-size-selector" class="visually-hidden">Font Size</label>
                                    <select class="font-size-selector" id="font-size-selector" title="Font Size"
                                            aria-label="Select font size in pixels">
                                        <option value="8">8px</option>
                                        <option value="10">10px</option>
                                        <option value="12">12px</option>
                                        <option value="14">14px</option>
                                        <option value="16" selected>16px</option>
                                        <option value="18">18px</option>
                                        <option value="20">20px</option>
                                        <option value="24">24px</option>
                                        <option value="28">28px</option>
                                        <option value="32">32px</option>
                                    </select>
                                </div>
                                <div class="color-picker-controls">
                                    <label for="component-color-picker" class="visually-hidden">Component Color</label>
                                    <select class="component-color-picker" id="component-color-picker" title="Component Color"
                                            aria-label="Select component color">
                                        <option value="neutral" selected data-color="transparent">ðŸ”³ Neutral</option>
                                        <option value="light-blue" data-color="#E3F2FD">ðŸŸ¦ Light Blue</option>
                                        <option value="soft-green" data-color="#E8F5E8">ðŸŸ© Soft Green</option>
                                        <option value="pale-yellow" data-color="#FFF8E1">ðŸŸ¨ Pale Yellow</option>
                                        <option value="light-pink" data-color="#FCE4EC">ðŸŸª Light Pink</option>
                                        <option value="lavender" data-color="#F3E5F5">ðŸŸ£ Lavender</option>
                                    </select>
                                </div>
                                <div class="size-buttons">
                                    <button class="size-btn" id="size-down-btn" title="Decrease Font Size" aria-label="Decrease font size">
                                        <i class="fas fa-minus"></i>
                                    </button>
                                    <button class="size-btn" id="size-up-btn" title="Increase Font Size" aria-label="Increase font size">
                                        <i class="fas fa-plus"></i>
                                    </button>
                                </div>
                                <div class="formatting-buttons">
                                    <button class="format-btn" id="bold-btn" data-format="bold" title="Bold">
                                        <i class="fas fa-bold"></i>
                                    </button>
                                    <button class="format-btn" id="italic-btn" data-format="italic" title="Italic">
                                        <i class="fas fa-italic"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Mode Toggle Controls -->
                    <div class="mode-toggle-controls">
                        <button class="mode-toggle-btn active" id="content-mode-btn" data-mode="content">
                            <i class="fas fa-file-text"></i>
                            <span>Content</span>
                        </button>
                        <button class="mode-toggle-btn" id="question-mode-btn" data-mode="question">
                            <i class="fas fa-question-circle"></i>
                            <span>Question</span>
                        </button>
                    </div>

                    <div class="component-categories">
                        <div class="component-category">
                            <h4>Text Components</h4>
                            <div class="component-items">
                                <div class="component-item" draggable="true" data-component-type="heading">
                                    <i class="fas fa-heading"></i>
                                    <span>Heading</span>
                                </div>
                                <div class="component-item" draggable="true" data-component-type="paragraph">
                                    <i class="fas fa-paragraph"></i>
                                    <span>Paragraph</span>
                                </div>
                                <div class="component-item" draggable="true" data-component-type="definition">
                                    <i class="fas fa-book-open"></i>
                                    <span>Definition</span>
                                </div>
                            </div>
                        </div>
                        <div class="component-category">
                            <h4>Learning Components</h4>
                            <div class="component-items">
                                <div class="component-item" draggable="true" data-component-type="step-sequence">
                                    <i class="fas fa-list-ol"></i>
                                    <span>Step Sequence</span>
                                </div>
                                <div class="component-item" draggable="true" data-component-type="worked-example">
                                    <i class="fas fa-calculator"></i>
                                    <span>Worked Example</span>
                                </div>
                                <div class="component-item" draggable="true" data-component-type="memory-trick">
                                    <i class="fas fa-lightbulb"></i>
                                    <span>Memory Trick</span>
                                </div>
                                <div class="component-item" draggable="true" data-component-type="callout-box">
                                    <i class="fas fa-exclamation-circle"></i>
                                    <span>Callout Box</span>
                                </div>
                                <div class="component-item" draggable="true" data-component-type="hero-number">
                                    <i class="fas fa-chart-line"></i>
                                    <span>Hero Number</span>
                                </div>
                                <div class="component-item" draggable="true" data-component-type="four-pictures">
                                    <i class="fas fa-code"></i>
                                    <span>Four SVGs</span>
                                </div>
                                <div class="component-item" draggable="true" data-component-type="three-pictures">
                                    <i class="fas fa-code"></i>
                                    <span>Three SVGs (Editable)</span>
                                </div>
                                <div class="component-item" draggable="true" data-component-type="three-svgs">
                                    <i class="fas fa-shapes"></i>
                                    <span>Three SVGs (AI Generated)</span>
                                </div>
                                <div class="component-item" draggable="true" data-component-type="two-pictures">
                                    <i class="fas fa-code"></i>
                                    <span>Two SVGs</span>
                                </div>
                            </div>
                        </div>

                    </div>

                    <!-- Hidden API Buttons for AI Interaction -->
                    <div id="api-buttons" style="display:none;">
                        <!-- Template Component Buttons -->
                        <button id="api-add-heading" onclick="insertComponent('heading')">Add Heading</button>
                        <button id="api-add-paragraph" onclick="insertComponent('paragraph')">Add Paragraph</button>
                        <button id="api-add-definition" onclick="insertComponent('definition')">Add Definition</button>
                        <button id="api-add-step-sequence" onclick="insertComponent('step-sequence')">Add Step Sequence</button>
                        <button id="api-add-worked-example" onclick="insertComponent('worked-example')">Add Worked Example</button>
                        <button id="api-add-memory-trick" onclick="insertComponent('memory-trick')">Add Memory Trick</button>
                        <button id="api-add-callout-box" onclick="insertComponent('callout-box')">Add Callout Box</button>
                        <button id="api-add-hero-number" onclick="insertComponent('hero-number')">Add Hero Number</button>
                        <button id="api-add-four-pictures" onclick="insertComponent('four-pictures')">Add Four SVGs</button>
                        <button id="api-add-three-pictures" onclick="insertComponent('three-pictures')">Add Three SVGs</button>
                        <button id="api-add-three-svgs" onclick="insertComponent('three-svgs')">Add Three SVGs (AI)</button>
                        <button id="api-add-two-pictures" onclick="insertComponent('two-pictures')">Add Two SVGs</button>

                        <!-- Node Management Buttons -->
                        <button id="api-delete-node" onclick="deleteCurrentNode()">Delete Node</button>
                        <button id="api-select-node" onclick="selectNode(arguments[0])">Select Node</button>

                        <!-- Content Management Buttons -->
                        <button id="api-set-content" onclick="setNodeContent(arguments[0], arguments[1])">Set Content</button>
                        <button id="api-get-content" onclick="getNodeContent(arguments[0])">Get Content</button>

                        <!-- Template Assignment Buttons -->
                        <button id="api-assign-template" onclick="assignTemplate(arguments[0], arguments[1])">Assign Template</button>
                    </div>
                </div>

                <!-- Three-Panel Editor Layout -->
                <div class="editor-layout">
                    <!-- Left Panel - Node Navigation -->
                    <div id="node-navigation-panel" class="editor-panel">
                        <div class="panel-header">
                            <div class="header-left">
                                <button class="toggle-panel-btn" id="toggle-nodes-btn" title="Collapse panel">
                                    <i class="fas fa-chevron-left"></i>
                                </button>
                                <button class="view-mode-toggle-btn" id="view-mode-toggle-btn" title="Switch to visual view">
                                    <i class="fas fa-project-diagram"></i>
                                </button>
                                <h3>Nodes</h3>
                                <button class="add-node-btn" id="add-node-btn">
                                    <i class="fas fa-plus"></i>
                                    Add Node
                                </button>
                                <button class="import-csv-btn" id="import-csv-btn">
                                    <i class="fas fa-file-csv"></i>
                                    Import CSV
                                </button>
                            </div>
                            <div class="header-actions">
                            </div>
                            <input type="file" id="csv-file-input" accept=".csv" multiple style="display: none;">
                        </div>

                        <!-- Chapter Selector - Downloads Design -->
                        <div class="chapter-selector">
                            <select id="chapter-select">
                                <option value="1">Chapter 1: Fractions</option>
                                <option value="2">Chapter 2: Decimals</option>
                                <option value="3">Chapter 3: Percentages</option>
                            </select>
                        </div>

                        <div class="node-list" id="node-list">
                            <!-- Nodes will be loaded dynamically from session -->
                        </div>
                        <div class="visual-network-container" id="visual-network-container" style="display: none;">
                            <div class="visual-controls">
                                <button class="visual-control-btn" id="zoom-in-btn" title="Zoom In">
                                    <i class="fas fa-plus"></i>
                                </button>
                                <button class="visual-control-btn" id="zoom-out-btn" title="Zoom Out">
                                    <i class="fas fa-minus"></i>
                                </button>
                                <button class="visual-control-btn" id="reset-view-btn" title="Reset View">
                                    <i class="fas fa-home"></i>
                                </button>
                                <button class="visual-control-btn" id="position-mode-btn" title="Toggle node positioning mode">
                                    <i class="fas fa-arrows-alt"></i>
                                </button>
                                <button class="visual-control-btn" id="save-positions-btn" title="Save node positions">
                                    <i class="fas fa-save"></i>
                                </button>
                                <button class="visual-control-btn" id="delete-node-btn" title="Delete selected node" disabled>
                                    <i class="fas fa-trash"></i>
                                </button>
                                <button class="visual-control-btn" id="create-relationship-btn" title="Create relationship between selected nodes" disabled>
                                    <i class="fas fa-link"></i>
                                </button>
                            </div>
                            <svg id="visual-network-svg" class="visual-network-svg" width="100%" height="100%">
                                <defs>
                                    <!-- Arrowhead for LEADS_TO relationships -->
                                    <marker id="arrow-leads-to" markerWidth="10" markerHeight="7"
                                            refX="9" refY="3.5" orient="auto">
                                        <polygon points="0 0, 10 3.5, 0 7" fill="#007AFF" />
                                    </marker>
                                    <!-- Arrowhead for prerequisite relationships -->
                                    <marker id="arrow-prerequisite" markerWidth="10" markerHeight="7"
                                            refX="9" refY="3.5" orient="auto">
                                        <polygon points="0 0, 10 3.5, 0 7" fill="#FF6B6B" />
                                    </marker>
                                    <!-- Arrowhead for enrichment relationships -->
                                    <marker id="arrow-enrichment" markerWidth="10" markerHeight="7"
                                            refX="9" refY="3.5" orient="auto">
                                        <polygon points="0 0, 10 3.5, 0 7" fill="#51CF66" />
                                    </marker>
                                    <!-- Generic arrowhead -->
                                    <marker id="arrowhead" markerWidth="10" markerHeight="7"
                                            refX="9" refY="3.5" orient="auto">
                                        <polygon points="0 0, 10 3.5, 0 7" fill="#8E8E93" />
                                    </marker>
                                </defs>
                                <g id="network-content" transform="translate(0,0) scale(1)">
                                    <!-- Network nodes and connections will be added dynamically -->
                                </g>
                            </svg>

                            <!-- Relationship Metadata Panel (slides in from right) -->
                            <div id="relationship-metadata-panel" class="relationship-metadata-panel">
                                <div class="panel-header">
                                    <h3>Create Relationship</h3>
                                    <button class="panel-close-btn" id="panel-close-btn" title="Close">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                                <div class="panel-content">
                                    <div class="relationship-info">
                                        <label>Connection:</label>
                                        <div id="relationship-nodes-display" class="nodes-display">
                                            <span id="from-node-display">N001</span>
                                            <i class="fas fa-arrow-right"></i>
                                            <span id="to-node-display">N002</span>
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <label for="relationship-type-select">Relationship Type:</label>
                                        <select id="relationship-type-select" class="relationship-type-dropdown">
                                            <option value="LEADS_TO" data-color="#007AFF">ðŸ“˜ LEADS_TO - Next natural step</option>
                                            <option value="prerequisite" data-color="#FF6B6B">ðŸ“• PREREQUISITE - Required before</option>
                                            <option value="PREREQUISITE_FOR" data-color="#FF6B6B">ðŸ“• PREREQUISITE_FOR - This enables</option>
                                            <option value="enrichment" data-color="#51CF66">ðŸ“— ENRICHMENT - Optional/advanced</option>
                                        </select>
                                    </div>

                                    <div class="form-group">
                                        <label for="relationship-explanation">Explanation (optional):</label>
                                        <textarea
                                            id="relationship-explanation"
                                            class="relationship-explanation"
                                            placeholder="Why does this relationship exist? (e.g., 'Students must understand fractions before learning fraction addition')"
                                            rows="4"
                                        ></textarea>
                                    </div>

                                    <div id="panel-error-message" class="panel-error-message" style="display: none;"></div>

                                    <div class="panel-actions">
                                        <button id="panel-cancel-btn" class="panel-btn cancel-btn">Cancel</button>
                                        <button id="panel-save-btn" class="panel-btn save-btn">Save Relationship</button>
                                    </div>
                                </div>
                            </div>

                            <!-- Panel overlay (dims background) -->
                            <div id="panel-overlay" class="panel-overlay"></div>
                        </div>
                    </div>

                    <!-- Center Panel - Template Editor -->
                    <div id="template-editor-panel" class="editor-panel">
                        <div class="panel-header">
                            <h3>Template Editor</h3>
                            <div class="editor-controls">
                                <button class="save-btn" id="save-btn">
                                    <i class="fas fa-save"></i>
                                    Save
                                </button>
                            </div>
                        </div>
                        <div class="editor-canvas" id="editor-canvas">
                            <div class="drop-zone" id="drop-zone">
                                <div class="drop-zone-message">
                                    <i class="fas fa-mouse-pointer"></i>
                                    <h4>Start Building</h4>
                                    <p>Drag components from the toolbar above to begin creating your content</p>
                                </div>
                                <div class="drop-zone-pdf-upload" id="ai-upload-zone">
                                    <i class="fas fa-file-pdf"></i>
                                    <h4>AI Content Generation</h4>
                                    <p>Drop PDF here for AI suggestions</p>
                                    <input type="file" id="pdf-upload-input" accept=".pdf" style="display: none;">
                                    <div class="upload-progress" id="upload-progress" style="display: none;">
                                        <i class="fas fa-spinner fa-spin"></i>
                                        <span id="progress-text">LL AI is creating lesson</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Right Panel - Live Preview -->
                    <div id="live-preview-panel" class="editor-panel">
                        <div class="panel-header">
                            <h3>Live Preview</h3>
                            <div class="preview-controls">
                                <select class="device-selector" id="device-selector">
                                    <option value="desktop">Desktop</option>
                                    <option value="tablet">Tablet</option>
                                    <option value="mobile">Mobile</option>
                                </select>
                                <button class="preview-student-btn" id="preview-student-btn" title="Preview as Student">
                                    <i class="fas fa-eye"></i> Student View
                                </button>
                                <button class="export-btn" id="export-btn">Export</button>
                            </div>
                        </div>
                        <div class="preview-container" id="preview-container">
                            <div class="preview-frame">
                                <div class="preview-content" id="preview-content">
                                    <div class="preview-placeholder">
                                        <i class="fas fa-eye"></i>
                                        <h4>Preview</h4>
                                        <p>Your content will appear here as you build it</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Question Mode Interface -->
                    <div class="question-mode-interface" id="question-mode-interface"
                         style="display: none;"
                         data-session-id=""
                         data-node-id="">
                        <!-- React Question Builder mounts here -->
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- AI Chat Slide-Out Drawer -->
    <div class="chat-slide-container" id="chat-slide-container">
        <!-- Animated chat button is created via JavaScript (animated-chat-button.js) -->
        <div class="chat-panel-overlay" id="chat-panel-overlay">
            <div class="chat-panel-header">
                <h3>
                    <i class="fas fa-robot"></i> AI Assistant
                    <span id="connection-status" class="status-dot status-disconnected" title="Disconnected"></span>
                </h3>
                <button class="close-chat-btn" id="close-chat-drawer" title="Close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="chat-container">
                <div class="chat-messages" id="chat-messages">
                    <div class="chat-welcome">
                        <i class="fas fa-robot"></i>
                        <p>AI Assistant ready. I can help you create and edit educational content.</p>
                    </div>
                </div>
                <div class="chat-input-container">
                    <div class="chat-context-indicator" id="chat-context-indicator">
                        <i class="fas fa-map-marker-alt"></i>
                        <span id="current-node-name">No node selected</span>
                    </div>
                    <!-- File Preview Badge (hidden by default) -->
                    <div id="file-preview-badge" class="file-preview-badge hidden">
                        <span class="file-icon">ðŸ“„</span>
                        <span class="file-name" id="file-preview-name">document.pdf</span>
                        <button class="remove-file-btn" id="remove-file-btn" title="Remove attachment">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="chat-input-wrapper">
                        <!-- Hidden file input -->
                        <input type="file" id="chat-file-input" accept=".pdf,image/*" style="display: none;">
                        <!-- Paperclip button (shows on hover/focus) -->
                        <button id="attach-file-btn" class="attach-file-btn" title="Attach file">
                            <i class="fas fa-paperclip"></i>
                        </button>
                        <textarea
                            id="chat-input"
                            class="chat-input"
                            placeholder="Ask me to add components, edit content..."
                            rows="2"
                        ></textarea>
                        <button id="send-chat-btn" class="send-chat-btn" title="Send message">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- GSAP for animations -->
    <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/gsap.min.js"></script>
    <script src="animated-chat-button.js"></script>
    <script src="websocket-chat.js"></script>

    <!-- CMS Utility Functions (must load before app.js) -->
    <script src="utils/text-utils.js"></script>
    <script src="utils/svg-generators.js"></script>

    <!-- Component System (must load before app.js) -->
    <script src="components/_base/BaseComponent.js"></script>
    <script src="components/heading/HeadingComponent.js"></script>
    <script src="components/paragraph/ParagraphComponent.js"></script>
    <script src="components/memory-trick/MemoryTrickComponent.js"></script>
    <script src="components/definition/DefinitionComponent.js"></script>
    <script src="components/worked-example/WorkedExampleComponent.js"></script>
    <script src="components/callout-box/CalloutBoxComponent.js"></script>
    <script src="components/step-sequence/StepSequenceComponent.js"></script>
    <script src="components/registry.js"></script>

    <script src="app.js"></script>
</body>
</html>